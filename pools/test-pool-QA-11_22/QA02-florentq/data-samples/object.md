# BankReviews

BankReviews — веб-приложение, предназначенное для сбора и хранения данных о различных банковских продуктах. Это приложение всё ещё находится на стадии разработки, однако базовый функционал в нём уже реализован  и размещён на отдельном [веб-сервере](http://10.101.255.2:4200). В ходе этого курса ты не раз будешь сталкиваться с этим приложением, поэтому мы для тебя написали небольшую инструкцию, которая поможет тебе быстрее разобраться в том, как тут всё устроено. Для начала разберёмся с системой ролей.

## Система пользовательских ролей

В зависимости от роли пользователя, ему доступны различные действия:
- Незарегистрированный пользователь (гость) может только просматривать отзывы других людей и общий рейтинг банков и продуктов, которые они предоставляют.
- Зарегистрированный пользователь (клиент банка) может оставлять отзывы на продукты, отвечать на отзывы других пользователей, а также предлагать новые банки или продукты, если их ещё нет в базе BankReview.
- Работник может просматривать статистику своего банка (к которому он прикреплён), а также добавлять новые банковские продукты.
- Администратор имеет доступ к экранам добавления и изменения банков и продуктов, модерации отзывов, прикреплению сотрудников к банкам.

Теперь разберёмся с тем, как регистрироваться через веб-интерфейс.

## Регистрация через пользовательский интерфейс

### Регистрация клиента

Чтобы зарегистрироваться в качестве обычного клиента, нужно:
1. Нажать на иконку "ключа" в верхнем правом углу;
2. Под основной формой авторизации нажать на ссылку _Регистрация_;
3. Заполнить все поля и нажать на кнопку _Зарегистрироваться_.

### Регистрация сотрудника

Перед регистрацией сотрудника убедись в том, что в системе был создан хотя бы один банк. Чтобы зарегистрироваться как работник банка, тебе нужно: 
1. Нажать на иконку "ключа" в верхнем правом углу;
2. Под основной формой авторизации нажать на ссылку _Регистрация_;
3. Под появившейся формой нажать на ссылку _Регистрация работника_: появится дополнительное поле в окне регистрации — *Банк*;
4. Далее нужно заполнить все обязательные поля и нажать на кнопку _Зарегистрироваться_.

_P.S.: Банк нужно выбирать из выпадающего списка, а не просто вводить его название_.

## Создание банка

Для того, чтобы добавить новый банк в систему, тебе нужно:
1. Войти в аккаунт администратора. Для этого необходимо в верхнем правом углу нажать на иконку "ключа", откроется модальное окно для авторизации в приложении (данные для входа: email по умолчанию: `admin@mail.ru`, пароль по умолчанию: `Admin`);
2. После успешной авторизации открыть меню в левом верхнем углу;
3. Выбрать пункт _Создание банка_;
4. В открывшемся модальном окне заполнить все поля и создать новый банк.

## Регистрация через API

Дальше все инструкции описаны с использованием _Swagger UI_, но ты можешь пользоваться любым другим инструментом для тестирования API!

### Авторизация в Swagger

- Открой описание эндпоинта `POST ​/api​/authorization​/login` и нажми на кнопку _Try it out_;
- В теле запроса укажи почту и пароль для входа в аккаунт. Например, чтобы войти в аккаунт администратора, нужно вписать:
```json
{
  "email": "admin@mail.ru",
  "password": "Admin"
}
```
- Выполни запрос кнопкой _Execute_;
- Если ты всё сделал правильно и авторизация прошла успешно, в ответе от сервера ты получишь access token, который нужно скопировать;
- Вверху страницы, в правой части нажми на кнопку _Authorize_;
- В открывшемся текстовом поле впиши `bearer <token>`, вместо `<token>` вставь тот, что скопировал;
- После этого ты сможешь выполнять запросы, которые требуют прохождение авторизации.

### Создание банка

- Открой описание эндпоинта `POST /api​/banks` и нажми _Try it out_;
- Заполни все необходимые поля. Например:
```json
{
  "name": "A-Bank",
  "description": "Описание банка",
  "shortName": "A"
}
```
- После выполнения запроса получим результат. Например:
```json
{
  "bankId": "697f2876-c9b2-4656-a5a9-8e5bcfaec354",
  "name": "A-Bank",
  "description": "Описание банка",
  "state": 2,
  "rating": 0,
  "shortName": "A"
}
```
В дальнейшем для регистрации работника необходимо записать `bankId`. Если же ты забыл это сделать, то узнать идентификатор банка можно, выполнив запрос `GET /api​/banks`. Например, ответ от сервера может быть таким:
```json
[
  {
    "bankId": "697f2876-c9b2-4656-a5a9-8e5bcfaec354",
    "name": "A-Bank",
    "description": "Описание банка",
    "state": 2,
    "rating": 0,
    "shortName": "A"
  }
]
```

### Получение списка ролей

- Открой описание эндпоинта `GET /api/roles` и нажми _Try it out_;
- Отправь запрос. Пример ответа:
```json
[
  {
    "roleId": "1f18f16c-d73f-4234-b8fd-33ff6242dab2",
    "name": "Admin"
  },
  {
    "roleId": "b6ac9a45-4032-4289-b439-2cc4d65c3f18",
    "name": "Client"
  },
  {
    "roleId": "2258b464-f412-4ccd-80f4-6ec3053fd4a5",
    "name": "Employee"
  }
]
```
В дальнейшем отсюда нам будут нужны `roleId`.

### Регистрация пользователя

- Открой описание эндпоинта `POST ​/api​/authorization​/register` и нажми _Try it out_;
- Заполни все необходимые поля в теле запроса. Поле `roleId` нужно сменить на id роли клиента. Пример:
```json
{
  "name": "user1",
  "birthday": "2022-09-19T16:25:08.562Z",
  "sex": 0,
  "email": "user1@mail.ru",
  "password": "password",
  "roleId": "b6ac9a45-4032-4289-b439-2cc4d65c3f18"
}
```
- Результат после выполнения запроса:
```json
{
  "userId": "5380273f-1bcd-44d2-aa06-4e0753846c1f",
  "name": "user1",
  "birthaday": "2022-09-19T16:25:08.562Z",
  "sex": 0,
  "email": "user1@mail.ru",
  "roleId": "b6ac9a45-4032-4289-b439-2cc4d65c3f18",
  "bankId": null,
  "state": 0
}
```

### Регистрация работника банка

- Открой описание эндпоинта `POST ​/api​/authorization​/register` и нажми _Try it out_
- Заполни все необходимые поля в теле запроса. Поле `roleId` поменяй на id роли работника, а в поле `bankId` тебе нужно вставить id банка, работником которого является регистрируемый пользователь. Пример:
```json
{
  "name": "staff1",
  "birthday": "2022-09-19T16:25:08.562Z",
  "sex": 0,
  "email": "staff1@mail.ru",
  "password": "password",
  "roleId": "2258b464-f412-4ccd-80f4-6ec3053fd4a5",
  "bankId": "697f2876-c9b2-4656-a5a9-8e5bcfaec354"
}
```
- Ответ от сервера:
```json
{
  "userId": "eba286a6-2284-44e8-a9e0-ee54301c9a3d",
  "name": "staff1",
  "birthaday": "2022-09-19T16:25:08.562Z",
  "sex": 0,
  "email": "staff1@mail.ru",
  "roleId": "2258b464-f412-4ccd-80f4-6ec3053fd4a5",
  "bankId": "697f2876-c9b2-4656-a5a9-8e5bcfaec354",
  "state": 1
}
```
